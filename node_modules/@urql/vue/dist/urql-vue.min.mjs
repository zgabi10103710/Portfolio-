import{Client as e,createRequest as u}from"@urql/core";export*from"@urql/core";import{isRef as a,ref as r,provide as t,getCurrentInstance as v,inject as n,reactive as l,watchEffect as s,onBeforeUnmount as o,onMounted as i}from"vue";import{subscribe as c,onEnd as p,toPromise as f,take as b}from"wonka";function h(u){var v;return v=a(u)?u:r(u instanceof e?u:new e(u)),t("$urql",v),v.value}function x(u,t){var v;v=a(t)?t:r(t instanceof e?t:new e(t)),u.provide("$urql",v)}function y(){return n("$urql")}function d(e){return e&&a(e)?e.value:e}var q={flush:"pre"};function m(e){return P(e)}function P(e,t=y(),v=[]){var n=l(e),o=r(),i=r(!1),f=r(!1),b=r(),h=r(),x=r(),m=a(e.pause)?e.pause:r(!!e.pause),P=r(u(n.query,d(n.variables))),g=r();v.push(s((()=>{var e=u(n.query,d(n.variables));P.value.key!==e.key&&(P.value=e)}),q)),v.push(s((()=>{g.value=m.value?void 0:t.value.executeQuery(P.value,{requestPolicy:n.requestPolicy,...n.context})}),q));var k={data:o,stale:i,error:b,operation:h,extensions:x,fetching:f,isPaused:m,executeQuery(e){var u=g.value=t.value.executeQuery(P.value,{requestPolicy:n.requestPolicy,...n.context,...e});return{...w,then(e,a){var r;return new Promise((e=>{var a=!1;r=c((()=>{k.fetching.value||k.stale.value||(r&&r.unsubscribe(),a=!0,e(k))}))(u),a&&r.unsubscribe()})).then(e,a)}}},pause(){m.value=!0},resume(){m.value=!1}};v.push(s((e=>{g.value?(f.value=!0,i.value=!1,e(c((e=>{o.value=e.data,i.value=!!e.stale,f.value=!1,b.value=e.error,h.value=e.operation,x.value=e.extensions}))(p((()=>{f.value=!1,i.value=!1}))(g.value)).unsubscribe)):(f.value=!1,i.value=!1)}),{flush:"sync"}));var w={...k,then(e,u){var a;return new Promise((e=>{if(!g.value)return e(k);var u=!1;a=c((()=>{k.fetching.value||k.stale.value||(a&&a.unsubscribe(),u=!0,e(k))}))(g.value),u&&a.unsubscribe()})).then(e,u)}};return w}function g(e){return k(e)}function k(e,a=y()){var t=r(),v=r(!1),n=r(!1),l=r(),s=r(),o=r();return{data:t,stale:v,fetching:n,error:l,operation:s,extensions:o,executeMutation:(r,i)=>(n.value=!0,f(b(1)(a.value.executeMutation(u(e,d(r)),i||{}))).then((e=>(t.value=e.data,v.value=!!e.stale,n.value=!1,l.value=e.error,s.value=e.operation,o.value=e.extensions,e))))}}var w={flush:"pre"};function Q(e,u){return S(e,u)}function S(e,t,v=y(),n=[]){var o=l(e),i=r(),f=r(!1),b=r(!1),h=r(),x=r(),q=r(),m=r(t),P=a(e.pause)?e.pause:r(!!e.pause),g=r(u(o.query,d(o.variables))),k=r();n.push(s((()=>{var e=u(o.query,d(o.variables));g.value.key!==e.key&&(g.value=e)}),w)),n.push(s((()=>{k.value=P.value?void 0:v.value.executeSubscription(g.value,{...o.context})}),w)),n.push(s((e=>{k.value?(b.value=!0,e(c((e=>{b.value=!0,i.value=void 0!==e.data&&"function"==typeof m.value?m.value(i.value,e.data):e.data,h.value=e.error,q.value=e.extensions,f.value=!!e.stale,x.value=e.operation}))(p((()=>{b.value=!1}))(k.value)).unsubscribe)):b.value=!1}),w));var Q={data:i,stale:f,error:h,operation:x,extensions:q,fetching:b,isPaused:P,executeSubscription:e=>(k.value=v.value.executeSubscription(g.value,{...o.context,...e}),Q),pause(){P.value=!0},resume(){P.value=!1}};return Q}function M(){var e=y(),u=[];return o((()=>{for(var e;e=u.shift();)e()})),{client:e.value,useQuery:a=>P(a,e,u),useSubscription:(a,r)=>S(a,r,e,u),useMutation:u=>k(u,e)}}export{x as default,x as install,h as provideClient,M as useClientHandle,g as useMutation,m as useQuery,Q as useSubscription};
//# sourceMappingURL=urql-vue.min.mjs.map
