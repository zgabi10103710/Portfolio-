Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@urql/core"),u=require("vue"),r=require("wonka");function a(r,a){var t;t=u.isRef(a)?a:u.ref(a instanceof e.Client?a:new e.Client(a)),r.provide("$urql",t)}function t(){return u.inject("$urql")}function n(e){return e&&u.isRef(e)?e.value:e}var s={flush:"pre"};function l(a,l=t(),v=[]){var i=u.reactive(a),o=u.ref(),c=u.ref(!1),f=u.ref(!1),p=u.ref(),b=u.ref(),h=u.ref(),x=u.isRef(a.pause)?a.pause:u.ref(!!a.pause),d=u.ref(e.createRequest(i.query,n(i.variables))),y=u.ref();v.push(u.watchEffect((()=>{var u=e.createRequest(i.query,n(i.variables));d.value.key!==u.key&&(d.value=u)}),s)),v.push(u.watchEffect((()=>{y.value=x.value?void 0:l.value.executeQuery(d.value,{requestPolicy:i.requestPolicy,...i.context})}),s));var q={data:o,stale:c,error:p,operation:b,extensions:h,fetching:f,isPaused:x,executeQuery(e){var u=y.value=l.value.executeQuery(d.value,{requestPolicy:i.requestPolicy,...i.context,...e});return{...w,then(e,a){var t;return new Promise((e=>{var a=!1;t=r.subscribe((()=>{q.fetching.value||q.stale.value||(t&&t.unsubscribe(),a=!0,e(q))}))(u),a&&t.unsubscribe()})).then(e,a)}}},pause(){x.value=!0},resume(){x.value=!1}};v.push(u.watchEffect((e=>{y.value?(f.value=!0,c.value=!1,e(r.subscribe((e=>{o.value=e.data,c.value=!!e.stale,f.value=!1,p.value=e.error,b.value=e.operation,h.value=e.extensions}))(r.onEnd((()=>{f.value=!1,c.value=!1}))(y.value)).unsubscribe)):(f.value=!1,c.value=!1)}),{flush:"sync"}));var w={...q,then(e,u){var a;return new Promise((e=>{if(!y.value)return e(q);var u=!1;a=r.subscribe((()=>{q.fetching.value||q.stale.value||(a&&a.unsubscribe(),u=!0,e(q))}))(y.value),u&&a.unsubscribe()})).then(e,u)}};return w}function v(a,s=t()){var l=u.ref(),v=u.ref(!1),i=u.ref(!1),o=u.ref(),c=u.ref(),f=u.ref();return{data:l,stale:v,fetching:i,error:o,operation:c,extensions:f,executeMutation:(u,t)=>(i.value=!0,r.toPromise(r.take(1)(s.value.executeMutation(e.createRequest(a,n(u)),t||{}))).then((e=>(l.value=e.data,v.value=!!e.stale,i.value=!1,o.value=e.error,c.value=e.operation,f.value=e.extensions,e))))}}var i={flush:"pre"};function o(a,s,l=t(),v=[]){var o=u.reactive(a),c=u.ref(),f=u.ref(!1),p=u.ref(!1),b=u.ref(),h=u.ref(),x=u.ref(),d=u.ref(s),y=u.isRef(a.pause)?a.pause:u.ref(!!a.pause),q=u.ref(e.createRequest(o.query,n(o.variables))),w=u.ref();v.push(u.watchEffect((()=>{var u=e.createRequest(o.query,n(o.variables));q.value.key!==u.key&&(q.value=u)}),i)),v.push(u.watchEffect((()=>{w.value=y.value?void 0:l.value.executeSubscription(q.value,{...o.context})}),i)),v.push(u.watchEffect((e=>{w.value?(p.value=!0,e(r.subscribe((e=>{p.value=!0,c.value=void 0!==e.data&&"function"==typeof d.value?d.value(c.value,e.data):e.data,b.value=e.error,x.value=e.extensions,f.value=!!e.stale,h.value=e.operation}))(r.onEnd((()=>{p.value=!1}))(w.value)).unsubscribe)):p.value=!1}),i));var P={data:c,stale:f,error:b,operation:h,extensions:x,fetching:p,isPaused:y,executeSubscription:e=>(w.value=l.value.executeSubscription(q.value,{...o.context,...e}),P),pause(){y.value=!0},resume(){y.value=!1}};return P}exports.default=a,exports.install=a,exports.provideClient=function(r){var a;return a=u.isRef(r)?r:u.ref(r instanceof e.Client?r:new e.Client(r)),u.provide("$urql",a),a.value},exports.useClientHandle=function(){var e=t(),r=[];return u.onBeforeUnmount((()=>{for(var e;e=r.shift();)e()})),{client:e.value,useQuery:u=>l(u,e,r),useSubscription:(u,a)=>o(u,a,e,r),useMutation:u=>v(u,e)}},exports.useMutation=function(e){return v(e)},exports.useQuery=function(e){return l(e)},exports.useSubscription=function(e,u){return o(e,u)},Object.keys(e).forEach((function(u){"default"===u||exports.hasOwnProperty(u)||Object.defineProperty(exports,u,{enumerable:!0,get:function(){return e[u]}})}));
//# sourceMappingURL=urql-vue.min.js.map
